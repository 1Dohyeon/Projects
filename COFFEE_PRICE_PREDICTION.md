# Coffee Price Prediction

> **커피 생두 가격 예측**
> - 링크: [MJU-Capstone-2025 repositories](https://github.com/orgs/MJU-Capstone-2025/repositories)

## 1. 프로젝트 개요

- **참가 인원**: 6인 프로젝트
- **기간**: 2025/03 ~ 2025/06 (4학년 1학기)
- **기술 스택**: React, FastAPI, Pytorch
- **담당 파트**: 데이터 엔지니어링, 모델 서빙, 풀스택

본 프로젝트는 커피 생두(Coffee Green Bean)의 가격을 예측하는 시계열 기반 머신러닝 모델을 개발하는 것을 목표로 한다. 본 모델은 커피 원두 유통업체, 로스터리, 카페 프랜차이즈 운영자 등 커피 산업 종사자들이 시장의 변동성에 대응하고 전략적 의사결정을 내릴 수 있도록 지원하는 도구로 활용될 예정이다.

프로젝트는 주요 목표는 다음과 같다.
1. 다변량 시계열 모델 설계: 생두 가격에 영향을 미치는 기후 데이터(기온, 강수량), 환율(생산국 통화), 국제 유가 등 복합적인 글로벌 지표를 반영한 예측 모델 개발
2. 비전문가도 활용 가능한 인터페이스 개발: 업계 종사자가 직관적으로 사용할 수 있는 시각화 및 예측 결과 제공 시스템 구축
3. 모델 성능 고도화: 다양한 알고리즘 비교 및 최적화를 통한 예측 정확도 향상

> 본 프로젝트는 수집, 분석, 예측을 모두 실시간으로 자동화하는 것이 최종 목표였다. 하지만 실시간 데이터 수집의 경우 api 비용 발생 이슈로 수집 가능한 범위의 데이터로 분석, 예측을 진행하였다. 데이터 가공과 모델 학습 부분은 자동화하였기에, 실시간 데이터 수집만 된다면 초기 목표로 확장 가능하다. 

## 2. 프로젝트 배경

생두는 대표적인 국제 원자재로서, 그 가격은 생산국의 기후 변화, 국제 정세, 물류 비용, 환율 등 다양한 외부 요인에 따라 높은 변동성을 보인다. 이러한 가격 불안정성은 수입업체 및 유통업체의 경영 리스크를 증가시키며, 궁극적으로는 소비자 가격에 영향을 미칠 수 있다. 최근에는 이러한 생두 가격의 향후 흐름을 정밀하게 예측하고자 하는 산업적 수요가 높아지고 있다.

정확한 가격 예측은 수입업체의 계약 전략, 로스터리의 원재료 조달 계획, 카페 운영자의 가격 정책 등 실무 전반에 걸쳐 중요한 의사결정 기반이 된다. 또한 예측 모델이 제공하는 데이터는 소비자 가격 안정화에도 기여할 수 있다.

본 프로젝트는 머신러닝 기반의 정량 분석을 통해 업계 종사자에게 신뢰도 높은 예측 정보를 제공함으로써, 급변하는 시장 환경 속에서 실질적인 대응력을 높이는 데 기여하고자 한다.

## 3. 프로젝트 설계 요약

### 3.1. 데이터 수집 및 가공(공동 구현)

#### 3.1.1 데이터 수집

NASA 기후 데이터와 yfinance를 활용하여 기후 및 경제 데이터를 수집하였다. 이때 커피 재배 주요국인 브라질, 콜롬비아, 에티오피아의 기후 데이터만을 수집하였다. 기사 데이터는 Selenium을 활용하여 FAO, USDA, World Coffee Portal 등에서 커피 관련 뉴스를 수집하였다.

#### 3.1.2 데이터 가공 및 데이터의 한계점

기후 데이터와 거시 경제 데이터를 하나의 테이블로 통합하는 작업을 수행하였다. 그러나 기후 데이터는 일별 단위인 반면, 거시 경제 데이터는 월별 또는 연도별로 구성되어 있어 해상도 차이의 문제가 있었다. 이러한 차이를 보완하기 위해, 월/연도 단위 데이터를 단순히 일별로 복제하여 직선적으로 표현하는 대신, **스플라인 보간(Spline interpolation)** 기법을 활용하여 보다 자연스러운 곡선 형태로 변환하였다.

입력 데이터의 품질 한계점을 지적하자면, 일부 NASA 기후 데이터 컬럼에서는 최근 연도 정보가 누락된 현상이 관찰되었으며, NASA가 제공하는 위성 기반 기후 데이터는 전 지구 평균값을 기반으로 하기 때문에, 실제 재배 환경에서의 미세한 지형이나 고도 차이를 충분히 반영하지 못하는 한계가 있었다.

### 3.2 기후/경제 데이터 활용: LSTM + Attention 기반 가격 예측 모델 구현(기획/리뷰 참여)

#### 3.2.1 파생 변수 생성

기후/경제 데이터뿐 아니라 다음과 같이 파생 변수를 생성하였다.
- `Coffee_Price_Return`: 일간 수익률
- `abs_return`: 절대 수익률 크기
- `volatility_5d/10d`: 최근 5/10일간 변동성
- `momentum_1d/3d/5d`: 최근 1,3,5일간 순가격 상승폭
- `bollinger_width`: 상대 변동성
- `volatility_ratio`: 단기/중기 변동성 비율

또한 `재배지역명_PRECTOTCORR_harvets_mean`(재배지역별 비수확기 강수량 평균) 파생변수를 생성하였고, 이는 매 수확기 이전의 기후 상태를 반영하여 직전 비수확기 동안의 평균 강수량을 정적 변수로 저장하여 사용한 것이다.

#### 3.2.2 최종 모델 선정

최종 모델로는 **Attention 기반 LSTM 모델**을 선정하였다. 기존 LSTM 구조에 Attention 메커니즘을 결합함으로써, 시계열 데이터 내 예측에 중요한 정보를 보다 효과적으로 추출할 수 있도록 구성하였다. 기존 LSTM이 마지막 hidden state를 기반으로 예측을 수행하는 반면, Attention은 시퀀스 전반에서 중요도에 따라 가중치를 부여하여, 가격 예측의 정밀도를 높이는 데 기여한다.

![[모델 예측 결과.png]]

입력 시퀀스는 기본적으로 예측일 이전 **100일치 데이터**로 설정하였으며, 각 입력 시퀀스에 대해 **7일 및 14일 예측**을 각각 수행하였다. 두 모델은 상호 보완적으로 활용되어, **단기 이상 징후에 대한 선제 대응**과 **중기적 추세 판단**을 모두 가능하게 하는 것을 목표로 하였다.

|모델|목적|역할|
|---|---|---|
|7일 예측 모델|민감하게 반응하여 선제 대응|조기 경보 역할|
|14일 예측 모델|지속적인 흐름인지 여부 확인|추세 확정 역할|

기존 목표는 장기적인 가격 흐름을 예측하는 것이었다. 실제로는 **상승·하락세는 어느 정도 예측 가능했지만**, **급격한 변동성**은 모델이 제대로 반영하지 못하는 한계가 있었다. 이에 따라, 논의를 통해 예측 기간을 7일과 14일로 분리하고, 두 모델을 **병렬적으로 운용**하는 전략으로 전환하였다.

#### 3.2.3 예측 분기 감지

**최근 4일 평균 대비 예측값이 각각 +0.7% 이상 상승**할 경우 ‘Buy’ 신호를 발생시키는 규칙 기반 전략을 설정하였으며, 해당 신호는 실제 매매로 연결하지 않고 **검증 단계까지만 진행**하였다.

![[두 모델 예측 방향 반대.png]]

또한 두 예측(7, 14일) 간 차이가 커질 때 예측 불일치 구간으로 판단한다. 분기 신호는 확정된 매수/회피 판단이 아닌 보수적 접근 또는 판단 보류를 유도하는 경고성 보조 시그널이다. 사용자가 판단하려는 시점이 임계값이 넘은 시점이라면 사용자는 예측 결과에 대해 보수적인 판단을 진행한다. 빨간 점선 초과시 단기 예측이 과도하게 높다고 판단하며 파란 점선 하회 시 단기 예측이 과도하게 낮다고 판단한다.

Buy 신호가 발생한 시점에 매수하고 이를 일주일 보유했을 때의 누적 수익률이 어떻게 변하는지 시간 순서대로 시각화하면 다음과 같다.

![[수익률.png]]

#### 3.2.4 모델 검증

-     14일 예측 모델 성능

| RMSE    | MAE    |
| ------- | ------ |
| 12.9053 | 8.9388 |

-     7일 예측 모델 성능

| RMSE   | MAE    |
| ------ | ------ |
| 9.1426 | 6.6435 |

### 3.3 감성 분석 모델 설계(리뷰 참여)

수집된 기사의 title 정보를 활용하여 키워드 기반 필터링으로 생두 가격과 연관된 문장을 선별하였다. 다음으로 FinBERT를 활용해 각 문장의 감성을 분류하고 수치화된 점수를 날짜별로 집계하였으며, 이후 감성 feature와 커피 가격 등의 정형 데이터를 결합하여 예측 모델의 입력 테이블로 활용하였다.

### 3.4 모델 서버: FastAPI(직접 구현)

위 3.2에서 개발한 모델을 서버에 서빙하였고, 3.3 모델의 결과는 참고 지표로 조회하는 api를 구현하였다. 데이터베이스는 따로 사용하지 않고, 모델의 결과를 CSV로 저장한 후, FastAPI 프레임워크를 활용하여 배포하였다. 

모델의 결과는 시계열 LSTM 모델의 7일 결과, 14일 결과 두 가지를 반환한다. `/prediction-dev` 엔드포인트를 통해 예측 결과를 조회할 수 있으며, 각 예측 결과는 날짜(Date), 예측 가격(Predicted_Price), 실제 가격(Actual_Price)을 포함하며, 7일과 14일 예측 결과를 동시에 제공하여 다양한 기간의 예측 성능을 비교할 수 있도록 구성하였다.

감성 분석 모델 결과도 `/news` 엔드포인트를 통해 조회할 수 있다. 기사의 title, url, date, 감성 분석 결과(rise, neutral, fall) 외에도 데이터를 같이 반환한다. 시스템 UI에서는 언급한 특성들만 활용한다.

### 3.5 프로젝트 View(직접 구현)

UI 구축은 React 라이브러리를 활용하였으며, 위 **3.4 모델 서버**에서의 응답을 활용하여 그래프로 가격을 시각화하여 다음과 같이 보여준다.

![[./imgs/커피가격 예측 그래프 이미지.png]]

2주~1년 버튼은 하나의 화면상 그래프의 최대 X축 비율이다. 실제 가격과 7, 14일의 예측 가격을 한 눈에 비교할 수 있다. 구매 및 경고 신호는 신뢰도 검증만 하고, UI에는 구현하지 않았다. 검증을 통해 수익성을 확인하였으며, 검증 결과는 **3.2.3** 에서 확인할 수 있다.

![[뉴스 기사 조회.png]]

위 이미지는 감성 분석 모델의 결과를 보여준다. 중립 감성을 제외하고 상승 및 하락 예측 결과만을 필터링하여 표시하였으며, 각 뉴스 기사의 타이틀을 클릭하면 해당 기사의 원본 URL로 이동할 수 있다. 전체 기사 목록은 최신순으로 정렬되어 있어 최근 시장 동향을 우선적으로 확인할 수 있도록 구성하였다.

## 4. 성과 및 배운 점

- 시계열 예측 모델 및 감성 분석 모델 개발 실습
- ML 모델을 실서비스에 통합하는 MLOps 개념 및 FastAPI 기반 서빙 경험
- 데이터 전처리 자동화와 배치 처리 개념 이해

## 5. 참고자료

1.    박성빈, 김정환, & 안석기. (2020). 뉴스 감성 분석을 이용한 딥러닝 기반 주가 예측에 대한 연구. 한국정보처리학회 춘계학술대회 논문집, 27(1), 241-244.  
  

2.    조성호. (2021). 뉴스 콘텐츠의 오피니언 마이닝을 통한 매체별 주가상승 예측정확도 비교 연구. 정보과학회논문지, 48(5), 533-541.  
  

3.    김동진. (2019). 뉴스와 주가 빅데이터 감성분석을 통한 지능형 투자 모델. 정보처리학회논문지, 26(3), 157-166.  
  

4.    김성주, 김진수, & 임상현. (2021). 주가지수 방향성 예측을 위한 주제지향 감성사전 구축 방안. 한국지능정보시스템학회 학술대회논문집, 2021(하계), 332-375.  
  

5.    Ko-FinBERT-SC Github Repository. (2022). _Ko-FinBERT-SC: A Korean Financial Sentiment Classification Model Based on BERT.  
  
_

6.    Araci, D. (2019). _FinBERT: Financial Sentiment Analysis with Pre-trained Language Models.  
  
_

7.    Shen, Y., Zhang, P. K. (2024). _Financial Sentiment Analysis on News and Reports Using Large Language Models and FinBERT.  
  
_

8.    Devlin, J., Chang, M.-W., Lee, K., & Toutanova, K. (2019). _BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding._ Proceedings of _NAACL-HLT_, 4171-4186.  
  

9.    Pontiki, M., Galanis, D., Papageorgiou, H., Androutsopoulos, I., & Manandhar, S. (2014). _SemEval-2014 Task 4: Aspect Based Sentiment Analysis._ Proceedings of the 8th International Workshop on Semantic Evaluation (_SemEval 2014_), 27-35.  
  

_10._  _An Artificial Intelligence Approach to Prediction of Corn Yields under Extreme Weather Conditions Using Satellite and Meteorological Data  
  
_

11.  신성호 외(2018). _LSTM_ _네트워크를 활용한 농산물 가격 예측 모델_ A Prediction Model for Agricultural Products Price with LSTM Network, 416-429

12.  안재성. (n.d.). model_LSTM. Github. [](https://github.com/DSJosephAhn/model_LSTM)[https://github.com/DSJosephAhn/model_LSTM  
](https://github.com/DSJosephAhn/model_LSTM)

13.  이솔, 임민희, 이계민, 이현주, 김태홍, 조수민 (2022). 기후변화에 따른 커피생산량의 변화, 2022년 대한지리학회 연례학술대회 발표 논문요약집, 232-233.